<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Word Replacer</title>
  <style>
    :root{
      --bg:#0b0d12;--card:#121621;--muted:#8b93a7;--text:#e7ecf5;--accent:#4f8cff;--accent-2:#22c55e;--danger:#ef4444;--shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue","Noto Sans",sans-serif;background:radial-gradient(1200px 600px at 10% -10%,#1a2235 0%,transparent 60%),linear-gradient(180deg, #0a0c11 0%, #0a0c11 100%);color:var(--text)}
    .container{max-width:980px;margin:24px auto;padding:16px}
    .app{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
    header{padding:18px 16px 8px;border-bottom:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01))}
    h1{margin:0;font-size:20px;letter-spacing:.2px;display:flex;align-items:center;gap:10px}
    h1 svg{opacity:.9}
    .sub{color:var(--muted);font-size:13px;margin-top:6px}
    main{padding:16px}

    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}

    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:12px}
    .card h2{font-size:14px;margin:0 0 8px;color:#cbd5e1;letter-spacing:.2px}
    label{display:block;font-size:12px;color:var(--muted);margin:8px 0 6px}
    textarea,input[type="text"],select{width:100%;background:#0e1220;color:var(--text);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:10px 12px;font-size:14px;outline:none}
    textarea{min-height:160px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr auto;gap:8px;align-items:center}
    .rows{display:flex;flex-direction:column;gap:8px}

    .btn{appearance:none;border:none;border-radius:10px;padding:10px 12px;font-weight:600;font-size:14px;color:white;background:var(--accent);cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 4px 16px rgba(79,140,255,.25)}
    .btn.secondary{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.12)}
    .btn.success{background:var(--accent-2);box-shadow:0 6px 20px rgba(34,197,94,.25)}
    .btn.danger{background:transparent;color:#fecaca;border:1px solid rgba(239,68,68,.5)}
    .btn:active{transform:translateY(1px)}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px}

    .options{display:flex;flex-wrap:wrap;gap:10px;margin-top:6px}
    .toggle{display:inline-flex;align-items:center;gap:8px;background:#0e1220;border:1px solid rgba(255,255,255,.08);border-radius:999px;padding:6px 10px}
    .toggle input{accent-color:var(--accent)}

    .muted{color:var(--muted);font-size:12px}
    .counter{float:right;color:var(--muted);font-size:12px}

    .divider{height:1px;background:rgba(255,255,255,.06);margin:12px 0}
    .hint{font-size:12px;color:#a1a8bb}
    .pill{display:inline-flex;align-items:center;gap:6px;background:#0e1220;border:1px solid rgba(255,255,255,.08);border-radius:999px;padding:6px 10px;font-size:12px;color:#cbd5e1}
    .right{display:flex;justify-content:flex-end}
    .fade{opacity:.9}
    .sr{position:absolute;left:-9999px}
    .row .del{height:38px;width:38px;display:inline-flex;align-items:center;justify-content:center;border-radius:10px;background:#131a2a;border:1px solid rgba(255,255,255,.08);cursor:pointer}
    .row .del:hover{border-color:rgba(239,68,68,.6);color:#fecaca}

    .footer{display:flex;flex-wrap:wrap;gap:8px;justify-content:space-between;align-items:center;margin-top:10px}

    /* Paragraph list */
    .plist-controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:10px 0}
    .plist{display:flex;flex-direction:column;gap:10px;margin-top:6px;max-height:320px;overflow:auto}
    .pitem{border:1px solid rgba(255,255,255,.08);background:#0e1220;border-radius:12px;padding:10px}
    .phead{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:6px}
    .pidx{font-size:12px;color:#a1a8bb}
    .ptext{white-space:pre-wrap;font-size:13px;line-height:1.55;color:#e5e7eb}

    /* Combiner section */
    .combiner-grid{display:grid;gap:12px;margin:10px 0}
    .combiner-input{min-height:100px;resize:vertical}
    .combiner-output{background:#0a0e1a;min-height:120px;padding:12px;border:1px solid rgba(255,255,255,.08);border-radius:10px;white-space:pre-wrap;font-size:14px;line-height:1.5;color:#e5e7eb}
    .combiner-toolbar{display:flex;gap:8px;margin-top:10px}
  </style>
</head>
<body>
  <div class="container">
    <div class="app">
      <header>
        <h1>
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 7h10M7 12h10M7 17h6" stroke="#94a3b8" stroke-width="1.8" stroke-linecap="round"/></svg>
          Word Replacer
        </h1>
        <div class="sub">Paste text on the left, add replacement rules, then <b>Apply</b>. Copy the result with one tap. Works great on mobile.</div>
      </header>
      <main>
        <div class="grid">
          <!-- Left: Input + Options -->
          <section class="card">
            <h2>Original text</h2>
            <label for="input">Paste your sentences</label>
            <div class="counter" id="inCount">0 chars</div>
            <textarea id="input" placeholder="Paste or type here…"></textarea>

            <div class="divider"></div>
            <h2>Replacement rules</h2>
            <p class="hint fade" style="margin:0 0 8px">Add one or more pairs — all changes happen <span class="pill">simultaneously</span> so outputs don’t chain onto each other.</p>
            <div id="rows" class="rows" aria-live="polite"></div>

            <div class="toolbar" style="margin-top:8px">
              <button class="btn secondary" id="addRow" type="button" title="Add rule">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                Add rule
              </button>
              <button class="btn danger" id="clearRules" type="button" title="Remove all rules">Clear rules</button>
              <span class="muted" id="ruleCount" style="align-self:center;margin-left:auto">0 rule</span>
            </div>

            <div class="options">
              <label class="toggle"><input type="checkbox" id="whole" /> Whole words only</label>
              <label class="toggle"><input type="checkbox" id="case" /> Case sensitive</label>
              <label class="toggle"><input type="checkbox" id="preserve" /> Preserve casing style</label>
            </div>

            <p class="hint" style="margin-top:8px">Tip: <b>Whole words</b> uses word boundaries. If a rule contains punctuation (e.g. hyphens), you might want to turn it off.</p>
          </section>

          <!-- Right: Output -->
          <section class="card">
            <h2>Result</h2>
            <label for="output">Transformed text</label>
            <div class="counter" id="outCount">0 chars</div>
            <textarea id="output" readonly placeholder="Your result will appear here…"></textarea>

            <div class="footer">
              <div class="toolbar">
                <button class="btn" id="apply" type="button">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  Apply replacements
                </button>
                <button class="btn success" id="copy" type="button">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 9h8a2 2 0 012 2v7a2 2 0 01-2 2H9a2 2 0 01-2-2v-7a2 2 0 012-2z" stroke="currentColor" stroke-width="2"/><path d="M7 7h8a 2 2 0 012 2" stroke="currentColor" stroke-width="2"/></svg>
                  Copy result
                </button>
              </div>
              <button class="btn secondary" id="swap" type="button" title="Move result back to input">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 7h10M7 7l3-3M7 7l3 3M7 17h10M17 17l-3-3m3 3l-3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                Swap to input
              </button>
            </div>

            <div class="divider"></div>

            <!-- Per-paragraph copy -->
            <h2 style="margin-top:0">Copy by paragraph</h2>
            <div class="plist-controls">
              <label style="display:flex;gap:6px;align-items:center">Split by
                <select id="splitMode" style="width:auto">
                  <option value="blank">Blank line</option>
                  <option value="line">Each line</option>
                  <option value="custom">Custom delimiter…</option>
                </select>
              </label>
              <input id="splitCustom" type="text" placeholder="Type delimiter (e.g. ### or ---)" style="display:none;min-width:180px" />
              <button class="btn secondary" id="copyAll" type="button" title="Copy all items, each on its own paragraph">Copy all items</button>
            </div>
            <div id="plist" class="plist" aria-live="polite"></div>

            <div class="divider"></div>

            <!-- Text Combiner Section -->
            <h2 style="margin-top:0">Text Combiner</h2>
            <p class="hint fade" style="margin:0 0 8px">Paste sentences into each box below and combine them into one paragraph.</p>
            <div class="combiner-grid">
              <div>
                <label for="combine1">Box 1</label>
                <textarea id="combine1" class="combiner-input" placeholder="Paste first sentence here…"></textarea>
              </div>
              <div>
                <label for="combine2">Box 2</label>
                <textarea id="combine2" class="combiner-input" placeholder="Paste second sentence here…"></textarea>
              </div>
              <div>
                <label for="combine3">Box 3</label>
                <textarea id="combine3" class="combiner-input" placeholder="Paste third sentence here…"></textarea>
              </div>
            </div>
            <div class="combiner-toolbar">
              <button class="btn" id="combineBtn" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                Combine
              </button>
              <button class="btn success" id="copyCombined" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 9h8a2 2 0 012 2v7a2 2 0 01-2 2H9a2 2 0 01-2-2v-7a2 2 0 012-2z" stroke="currentColor" stroke-width="2"/><path d="M7 7h8a 2 2 0 012 2" stroke="currentColor" stroke-width="2"/></svg>
                Copy combined
              </button>
            </div>
            <div style="margin-top:10px">
              <label>Combined output</label>
              <div id="combinedOutput" class="combiner-output">Your combined text will appear here…</div>
            </div>
          </section>
        </div>
      </main>
    </div>
  </div>

  <template id="rowTemplate">
    <div class="row">
      <input class="find" type="text" placeholder="Find… (e.g. cat)" inputmode="latin" />
      <input class="repl" type="text" placeholder="Replace with… (e.g. dog)" inputmode="latin" />
      <button class="del" type="button" title="Delete this rule" aria-label="Delete this rule">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
    </div>
  </template>

  <script>
    const els = {
      input: document.getElementById('input'),
      output: document.getElementById('output'),
      inCount: document.getElementById('inCount'),
      outCount: document.getElementById('outCount'),
      rows: document.getElementById('rows'),
      addRow: document.getElementById('addRow'),
      clearRules: document.getElementById('clearRules'),
      apply: document.getElementById('apply'),
      copy: document.getElementById('copy'),
      swap: document.getElementById('swap'),
      ruleCount: document.getElementById('ruleCount'),
      whole: document.getElementById('whole'),
      kase: document.getElementById('case'),
      preserve: document.getElementById('preserve'),
      tpl: document.getElementById('rowTemplate'),
      // new
      plist: document.getElementById('plist'),
      splitMode: document.getElementById('splitMode'),
      splitCustom: document.getElementById('splitCustom'),
      copyAll: document.getElementById('copyAll'),
      // combiner
      combine1: document.getElementById('combine1'),
      combine2: document.getElementById('combine2'),
      combine3: document.getElementById('combine3'),
      combineBtn: document.getElementById('combineBtn'),
      copyCombined: document.getElementById('copyCombined'),
      combinedOutput: document.getElementById('combinedOutput'),
    };

    // --- Utilities ---
    const escapeRegex = (s) => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

    function buildRegex(keys, wholeWord, caseSensitive){
      if (!keys.length) return null;
      const sorted = [...keys].sort((a,b)=>b.length-a.length).map(escapeRegex);
      const alt = sorted.join('|');
      const b = wholeWord ? `\\b(?:${alt})\\b` : `(?:${alt})`;
      const flags = 'g' + (caseSensitive ? '' : 'i');
      try { return new RegExp(b, flags); }
      catch(e){ return null; }
    }

    function matchCase(repl, sample){
      if (!repl) return repl;
      if (sample.toUpperCase() === sample) return repl.toUpperCase();
      if (sample.toLowerCase() === sample) return repl.toLowerCase();
      if (sample[0] && sample[0] === sample[0].toUpperCase() && sample.slice(1) === sample.slice(1).toLowerCase()){
        return repl[0]?.toUpperCase() + repl.slice(1).toLowerCase();
      }
      return repl;
    }

    function collectRules(){
      const rows = Array.from(els.rows.querySelectorAll('.row'));
      const rules = [];
      for(const r of rows){
        const find = r.querySelector('.find').value;
        const repl = r.querySelector('.repl').value;
        if (find.trim() !== '') rules.push({find, repl});
      }
      return rules;
    }

    function rulesToMaps(rules){
      const exact = new Map();
      const lower = new Map();
      for (const {find, repl} of rules){
        exact.set(find, repl);
        lower.set(find.toLowerCase(), repl);
      }
      return {exact, lower};
    }

    function applyReplacements(){
      const text = els.input.value ?? '';
      const rules = collectRules();
      const whole = els.whole.checked;
      const cs = els.kase.checked;
      const preserve = els.preserve.checked && !cs;

      const keys = rules.map(r => r.find);
      const re = buildRegex(keys, whole, cs);
      if (!re){
        els.output.value = text; refreshCounts(); renderSegments(); return;
      }
      const { exact, lower } = rulesToMaps(rules);
      const out = text.replace(re, (m) => {
        const base = cs ? exact.get(m) : lower.get(m.toLowerCase());
        if (base === undefined) return m;
        return preserve ? matchCase(base, m) : base;
      });
      els.output.value = out;
      refreshCounts();
      renderSegments();
      persist();
    }

    function addRow(find='', repl=''){
      const node = els.tpl.content.firstElementChild.cloneNode(true);
      const f = node.querySelector('.find');
      const p = node.querySelector('.repl');
      f.value = find; p.value = repl;
      node.querySelector('.del').addEventListener('click', () => { node.remove(); updateRuleCount(); persist(); });
      f.addEventListener('input', () => { updateRuleCount(); persist(); });
      p.addEventListener('input', () => { persist(); });
      els.rows.appendChild(node);
      updateRuleCount();
      return node;
    }

    function updateRuleCount(){
      const n = collectRules().length;
      els.ruleCount.textContent = n + (n===1 ? ' rule' : ' rules');
    }

    function refreshCounts(){
      els.inCount.textContent = (els.input.value||'').length + ' chars';
      els.outCount.textContent = (els.output.value||'').length + ' chars';
    }

    async function copyText(txt){
      try {
        if (navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(txt);
        } else {
          const ta = document.createElement('textarea');
          ta.value = txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
        }
        toast('Copied');
      } catch(e){ toast('Copy failed'); }
    }

    async function copyOut(){
      await copyText(els.output.value || '');
    }

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      Object.assign(t.style,{position:'fixed',left:'50%',bottom:'24px',transform:'translateX(-50%)',background:'#111827',border:'1px solid rgba(255,255,255,.12)',color:'#e5e7eb',padding:'10px 14px',borderRadius:'10px',boxShadow:'0 10px 30px rgba(0,0,0,.35)',zIndex:50,fontSize:'13px'});
      document.body.appendChild(t);
      setTimeout(()=>{t.style.transition='all .3s ease';t.style.opacity='0';t.style.transform='translateX(-50%) translateY(8px)';},1200);
      setTimeout(()=>t.remove(),1700);
    }

    function swapIO(){
      const a = els.input.value; const b = els.output.value;
      els.input.value = b; els.output.value = a;
      refreshCounts();
      renderSegments();
      persist();
    }

    function clearRules(){
      els.rows.innerHTML = ''; updateRuleCount(); persist();
    }

    // --- Split / paragraph logic ---
    function getSegments(text){
      const mode = els.splitMode.value;
      if (!text) return [];
      if (mode === 'line') return text.split(/\n+/).map(s=>s.trim()).filter(Boolean);
      if (mode === 'custom'){
        const d = els.splitCustom.value;
        if (!d) return [text.trim()].filter(Boolean);
        const re = new RegExp(escapeRegex(d), 'g');
        return text.split(re).map(s=>s.trim()).filter(Boolean);
      }
      // default: blank line
      return text.split(/\n\s*\n+/).map(s=>s.trim()).filter(Boolean);
    }

    function renderSegments(){
      const segs = getSegments(els.output.value || '');
      els.plist.innerHTML = '';
      if (!segs.length){
        const empty = document.createElement('div');
        empty.className='hint';
        empty.textContent = 'No items to show — change the split mode or click Apply.';
        els.plist.appendChild(empty);
        return;
      }
      segs.forEach((t, i) => {
        const wrap = document.createElement('div');
        wrap.className = 'pitem';
        const head = document.createElement('div');
        head.className = 'phead';
        const idx = document.createElement('div');
        idx.className = 'pidx'; idx.textContent = `Item ${i+1}`;
        const btn = document.createElement('button');
        btn.className = 'btn success'; btn.type='button'; btn.textContent='Copy';
        btn.addEventListener('click', ()=> copyText(t));
        head.append(idx, btn);
        const body = document.createElement('div');
        body.className = 'ptext'; body.textContent = t;
        wrap.append(head, body);
        els.plist.appendChild(wrap);
      });
    }

    // --- Persistence ---
    const STORAGE_KEY = 'word-replacer-state-v2';
    function persist(){
      const state = {
        input: els.input.value || '',
        output: els.output.value || '',
        whole: els.whole.checked,
        kase: els.kase.checked,
        preserve: els.preserve.checked,
        rules: collectRules(),
        splitMode: els.splitMode.value,
        splitCustom: els.splitCustom.value || ''
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }
    function restore(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) throw 0;
        const s = JSON.parse(raw);
        els.input.value = s.input || '';
        els.output.value = s.output || '';
        els.whole.checked = !!s.whole;
        els.kase.checked = !!s.kase;
        els.preserve.checked = !!s.preserve;
        if (Array.isArray(s.rules) && s.rules.length){
          for(const r of s.rules) addRow(r.find||'', r.repl||'');
        } else {
          addRow();
        }
        if (s.splitMode) els.splitMode.value = s.splitMode;
        els.splitCustom.value = s.splitCustom || '';
        toggleCustomInput();
      }catch{ addRow(); }
      refreshCounts(); updateRuleCount(); renderSegments();
    }

    function toggleCustomInput(){
      els.splitCustom.style.display = els.splitMode.value === 'custom' ? 'block' : 'none';
    }

    // --- Events ---
    els.addRow.addEventListener('click', () => { const n=addRow(); n.querySelector('.find').focus(); persist(); });
    els.clearRules.addEventListener('click', clearRules);
    els.apply.addEventListener('click', applyReplacements);
    els.copy.addEventListener('click', copyOut);
    els.swap.addEventListener('click', swapIO);
    els.input.addEventListener('input', () => { refreshCounts(); persist(); });
    els.whole.addEventListener('change', () => { persist(); });
    els.kase.addEventListener('change', () => { if (els.kase.checked) els.preserve.checked = false; persist(); });
    els.preserve.addEventListener('change', () => { if (els.preserve.checked) els.kase.checked = false; persist(); });

    // New events
    els.splitMode.addEventListener('change', () => { toggleCustomInput(); renderSegments(); persist(); });
    els.splitCustom.addEventListener('input', () => { renderSegments(); persist(); });
    els.copyAll.addEventListener('click', () => {
      const segs = getSegments(els.output.value || '');
      if (!segs.length) return toast('Nothing to copy');
      copyText(segs.join('\n\n'));
    });

    // --- Combiner functions ---
    function combineTexts(){
      const text1 = (els.combine1.value || '').trim();
      const text2 = (els.combine2.value || '').trim();
      const text3 = (els.combine3.value || '').trim();
      const parts = [text1, text2, text3].filter(Boolean);
      const combined = parts.join(' ');
      els.combinedOutput.textContent = combined || 'Your combined text will appear here…';
      persistCombiner();
    }

    async function copyCombinedText(){
      const text = els.combinedOutput.textContent;
      if (!text || text === 'Your combined text will appear here…'){
        toast('Nothing to copy');
        return;
      }
      await copyText(text);
    }

    // --- Combiner persistence ---
    const COMBINER_KEY = 'word-replacer-combiner-v1';
    function persistCombiner(){
      const state = {
        combine1: els.combine1.value || '',
        combine2: els.combine2.value || '',
        combine3: els.combine3.value || '',
        combined: els.combinedOutput.textContent || ''
      };
      localStorage.setItem(COMBINER_KEY, JSON.stringify(state));
    }
    function restoreCombiner(){
      try{
        const raw = localStorage.getItem(COMBINER_KEY);
        if(!raw) return;
        const s = JSON.parse(raw);
        els.combine1.value = s.combine1 || '';
        els.combine2.value = s.combine2 || '';
        els.combine3.value = s.combine3 || '';
        els.combinedOutput.textContent = s.combined || 'Your combined text will appear here…';
      }catch{}
    }

    // Combiner events
    els.combineBtn.addEventListener('click', combineTexts);
    els.copyCombined.addEventListener('click', copyCombinedText);
    els.combine1.addEventListener('input', persistCombiner);
    els.combine2.addEventListener('input', persistCombiner);
    els.combine3.addEventListener('input', persistCombiner);

    // Keyboard shortcut: Ctrl/Cmd+Enter => Apply
    window.addEventListener('keydown', (e)=>{
      if ((e.ctrlKey||e.metaKey) && e.key === 'Enter'){ e.preventDefault(); applyReplacements(); }
    });

    // Init
    restore();
    restoreCombiner();
  </script>
</body>
</html>
